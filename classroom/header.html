<!doctype html>
<html lang="fr">

<head>
    <script src="assets/js/utils/listener.js"></script>
    <script src="./path.js"></script>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="Content-Security-Policy" content="">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="assets/css/jquery-ui.css?version=VERSIONNUM">
    <link rel="stylesheet" href="assets/js/lib/bootstrap/bootstrap.min.css?version=VERSIONNUM">
    <link rel="stylesheet" href="assets/css/lib/fontawesome-free-6.4.2-web/css/all.min.css?version=VERSIONNUM">
    <script src="assets/js/lib/jquery/jquery.min.js?version=VERSIONNUM"></script>
    <script src="assets/js/lib/popper/popper.min.js?version=VERSIONNUM"></script>
    <script src="assets/js/lib/leader_line/leader-line.min.js ?version=VERSIONNUM"></script>
    <link rel="stylesheet" href="assets/css/theme.css?version=VERSIONNUM">
    <link rel="stylesheet" href="assets/css/login.css?version=VERSIONNUM">
    <link rel="stylesheet" href="assets/css/main.css?version=VERSIONNUM">
    <link rel="stylesheet" href="assets/css/modal.css?version=VERSIONNUM">
    <link rel="stylesheet" href="assets/css/components.css?version=VERSIONNUM">
    <!-- theme detection -->
    <script>
        function updateWebsiteAcessibility(formElement) {
            var accesibilityInputs = formElement.serializeArray();

            // first value is theme
            var theme = accesibilityInputs[0].value;

            // second value is font
            if (accesibilityInputs[1])
                var font = accesibilityInputs[1].value;

            setTheme(theme);
            setFont(font);

            const arInteraces = ['arduino', 'microbit', 'python', 'esp32'];
            if (arInteraces.includes((window.location.pathname).split('/')[1])) {
                const toolbox = new ToolboxManager(Main.getWorkSpace());
                toolbox.setBlocklyTheme();
                setTimeout(function () {
                    toolbox.setBlocklyTheme()
                }, 50);
            }
        };

        // function to set a given theme/color-scheme
        function setTheme(givenThemeName) {

            let themesTypes = ['light', 'dark'];
            localStorage.setItem('theme', givenThemeName);

            themesTypes.forEach(theme => {
                if (givenThemeName == theme) {
                    $('html').addClass("theme-" + theme);
                } else {
                    $('html').removeClass("theme-" + theme)
                }
            });

            if (localStorage.getItem('theme') === 'dark') {
                $(".navbar-logo").attr("src", "/public/content/img/vittascience-footer.png");
            } else {
                $(".navbar-logo").attr("src", "/public/content/img/vittascience-logo.png");
            }

            var codeMirrorContainer = $('.CodeMirror');
            switch (givenThemeName) {
                case "dark":
                    if (codeMirrorContainer.hasClass("cm-s-idle")) {
                        codeMirrorContainer.removeClass("cm-s-idle");
                    }
                    codeMirrorContainer.addClass("cm-s-idle-dark");
                    break;

                case "light":
                    if (codeMirrorContainer.hasClass("cm-s-idle-dark")) {
                        codeMirrorContainer.removeClass("cm-s-idle-dark");
                    }
                    codeMirrorContainer.addClass("cm-s-idle");
                    break;

                default:
                    break;
            }

        }

        // function to set a given font
        function setFont(givenFontName) {
            let fontTypes = ['basic', 'dys', 'luciole', 'arial', 'verdana'];

            localStorage.setItem('font', givenFontName);

            fontTypes.forEach(font => {
                if (givenFontName == font) {
                    $('html').addClass("font-" + font);
                } else {
                    $('html').removeClass("font-" + font)
                }
            });
        }

        /* Immediately invoked function to set the theme on initial load
        Looks for the local storage for the theme value, if not found looks for the OS settings
        */
        document.addEventListener('DOMContentLoaded', function () {
            setTimeout(function () {
                if (localStorage.getItem('theme') === 'dark') {
                    setTheme('dark');
                    $("#radio-dark-theme, #ide-radio-dark-theme").prop("checked", true);
                } else if (localStorage.getItem('theme') === 'light') {
                    setTheme('light');
                    $("#radio-light-theme, #ide-radio-light-theme").prop("checked", true);
                } else {
                    if (matchMedia('(prefers-color-scheme: dark)').matches) {
                        setTheme('dark');
                        $("#radio-dark-theme, #ide-radio-dark-theme").prop("checked", true);

                    } else {
                        setTheme('light');
                        $("#radio-light-theme, #ide-radio-light-theme").prop("checked", true);

                    }
                }

                if (localStorage.getItem('font') === 'dys') {
                    setFont('dys');
                    $("#radio-dys-font, #ide-radio-dys-font").prop("checked", true);
                } else if (localStorage.getItem('font') === 'luciole') {
                    setFont('luciole');
                    $("#radio-luciole-font, #ide-radio-luciole-font").prop("checked", true);
                } else if (localStorage.getItem('font') === 'arial') {
                    setFont('arial');
                    $("#radio-arial-font, #ide-radio-arial-font").prop("checked", true);
                } else if (localStorage.getItem('font') === 'verdana') {
                    setFont('verdana');
                    $("#radio-verdana-font, #ide-radio-verdana-font").prop("checked", true);
                } else {
                    setFont('basic');
                    $("#radio-basic-font, #ide-radio-basic-font").prop("checked", true);

                }

            }, 1000);
        });
    </script>
    <script src="assets/js/lib/mobile_detect/mobile-detect.min.js?version=VERSIONNUM"></script>
    <script>
        const md = new MobileDetect(window.navigator.userAgent);
        const mobileDetect = md.mobile();
    </script>
    <script src="assets/js/lib/nprogress.js?version=VERSIONNUM"></script>
    <script src="assets/js/lib/qr-creator.min.js?version=VERSIONNUM"></script>
    <script src="assets/js/lib/svg-inject.min.js?version=VERSIONNUM"></script>

